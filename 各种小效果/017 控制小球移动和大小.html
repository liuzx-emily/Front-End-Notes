<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>017 控制小球移动和大小</title>
    <style>
    .border {
        width: 451px;
        height: 451px;
        margin: 0 auto;
        border: 1px coral solid;
        position: relative;
    }
    
    #ball {
        width: 50px;
        height: 50px;
        background-color: #E1E1FF;
        border: 2px solid #CCCCFE;
        border-radius: 50px;
        position: absolute;
        left: 200px;
        top: 200px;
    }
    </style>
</head>

<body>
    <button type="button">左</button>
    <button type="button">右</button>
    <button type="button">上</button>
    <button type="button">右下</button>
    <button type="button">复位</button>
    <button type="button">停止变化大小</button>
    <button type="button">变化大小</button>
    <div class="border">
        <div id="ball"></div>
    </div>
    <script>
    var oBtn = document.getElementsByTagName('button');
    var oDiv = document.getElementById('ball');
    oBtn[0].onclick = function() {
        fnMove(oDiv, "left", 1, 0);
    };
    oBtn[1].onclick = function() {
        fnMove(oDiv, "left", 1, 400);
    };
    oBtn[2].onclick = function() {
        fnMove(oDiv, "top", 1, 0);
    };
    oBtn[3].onclick = function() {
        fnMove(oDiv, "top", 1, 400, function() {
            fnMove(oDiv, "left", 1, 400);
        });
    };
    oBtn[4].onclick = function() {
        fnMove(oDiv, "left", 5, 200, function() {
            fnMove(oDiv, "top", 5, 200);
        });
    };
    oBtn[5].onclick = function() {
        clearInterval(oDiv.sizeTimer);
    };
    oBtn[6].onclick = changeSize;

    function changeSize() {
        var changeToBig = true;
        clearInterval(oDiv.sizeTimer);
        oDiv.sizeTimer = setInterval(function() {
            oDiv.size = parseFloat(getComputedStyle(oDiv).width);
            if (oDiv.size <= 20) { //说明该变大了，改方向
                changeToBig = true;
            }
            if (oDiv.size >= 80) { //说明该变小了，改方向
                changeToBig = false;
            }
            if (changeToBig) {
                oDiv.style.width = oDiv.size + 0.2 + 'px';
                oDiv.style.height = oDiv.size + 0.2 + 'px';
            } else {
                oDiv.style.width = oDiv.size - 0.2 + 'px';
                oDiv.style.height = oDiv.size - 0.2 + 'px';
            }
        }, 1);
    }

    /**
     * 变速运动
     * @param  {[HTML元素]} Obj     
     * @param  {整数}    iTarget 
     * @return undefined       
     * 使用：fnMove2(oDiv, 1000);
     */
    function fnMove2(Obj, iTarget) {
        clearInterval(oDiv.timer);
        oDiv.timer = setInterval(function() {
            var fSpeed = (iTarget - Obj.offsetLeft) / 70;
            var iSpeed = fSpeed > 0 ? Math.ceil(fSpeed) : Math.floor(fSpeed);
            if (Obj.offsetLeft === iTarget) {
                clearInterval(oDiv.timer);
            } else { //这里没在定时器后return 用了else括起来
                oDiv.style.left = Obj.offsetLeft + iSpeed + 'px';
            }
        }, 1);
    }





    function fnMove(obj, dir, speed, target, endFn) {

        clearInterval(oDiv.timer);
        //判断速度方向
        if (parseFloat(getComputedStyle(obj)[dir]) > target) {
            speed = -speed;
        }
        oDiv.timer = setInterval(function() {
            oDiv.position = parseFloat(getComputedStyle(obj)[dir]) + speed;
            //speed>0时，position超过target，说明该停了，免得越界，设为target
            if (speed > 0 && oDiv.position >= target) {
                oDiv.position = target;
            }
            //speed<0时，position小于target，说明该停了，免得越界，设为target
            if (speed < 0 && oDiv.position <= target) {
                oDiv.position = target;
            }
            oDiv.style[dir] = oDiv.position + 'px';
            //到target了，停住
            if (oDiv.position == target) {
                clearInterval(oDiv.timer);
                /*if (endFn) { endFn(); }
                 */
                endFn && endFn();
            }
        }, 1);

    }
    </script>
</body>

</html>
