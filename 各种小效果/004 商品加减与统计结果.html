<!DOCTYPE HTML>
<html>

<head>
   <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <title>无标题文档</title>
   <script>
   window.onload = function() {
      var aLi = document.getElementsByTagName('li');

      var arrayNum = []; //存件数
      var arrayPrice = []; //存单价
      var arrayTotal = []; //存每个商品的总价

      var total = document.getElementsByTagName('p')[0];
      var totalNum = total.getElementsByTagName('strong')[0];
      var totalMoney = total.getElementsByTagName('span')[0];
      var expensive = total.getElementsByTagName('span')[1];

      /*初始化arrayNumarrayNum	arrayPrice	arrayTotal	*/
      for (var i = 0; i < aLi.length; i++) {
         var oLi = aLi[i];
         oLi.index = i; //每个li的序号
         arrayNum.push(parseInt(oLi.getElementsByTagName('strong')[0].innerHTML));
         arrayPrice.push(parseFloat(oLi.getElementsByTagName('em')[0].innerHTML));
         arrayTotal.push(arrayNum[arrayNum.length - 1] * arrayPrice[arrayPrice.length - 1]);
         myf(oLi);
      }
      //商品合计初始化
      setTotal();
      mostexpensive();

      //找最贵的
      function mostexpensive() {
         var now = []; //买了的东西的序号
         for (var i = 0; i < aLi.length; i++) {
            if (arrayNum[i] !== 0)
               now.push(i);
         }
         if (now.length === 0) { //如果不写这个if循环,now为空时，mostprice是undefined
            expensive.innerHTML = 0;
            return;
         }
         var mostone = now[0];
         var mostprice = arrayPrice[mostone];
         for (var i = 0; i < now.length; i++) {
            if (arrayPrice[now[i]] > mostprice) {
               mostone = now[i];
               mostprice = arrayPrice[mostone];
            }
         }
         expensive.innerHTML = mostprice;
      }

      //修改商品合计setTotal
      function setTotal() {
         var totalnum = 0;
         var totalmoney = 0;
         for (var i = 0; i < aLi.length; i++) {
            totalnum += arrayNum[i];
            totalmoney += arrayNum[i] * arrayPrice[i];
         }
         totalNum.innerHTML = totalnum;
         totalMoney.innerHTML = totalmoney;
      }

      //点+ -时的动作，index说明第几个li，action：1是+,-1是-
      function functions(index, action) {
         return function() {
            var li = aLi[index];
            if (action === 1) //1是加
               arrayNum[index]++;
            else { //-1是减
               if (arrayNum[index] === 0) //件数已经为0了
                  return;
               arrayNum[index]--;
            }
            arrayTotal[index] = arrayNum[index] * arrayPrice[index];
            li.howmany.innerHTML = arrayNum[index];
            li.total.innerHTML = arrayTotal[index] + '元';
            setTotal();
            mostexpensive();
         };
      }

      //为每个li加上+ -动作
      function myf(li) {
         var add = li.getElementsByTagName('input')[1];
         var minus = li.getElementsByTagName('input')[0];
         li.howmany = li.getElementsByTagName('strong')[0]; //0 <strong>
         li.price = li.getElementsByTagName('em')[0]; //12.5元 <em>
         li.total = li.getElementsByTagName('span')[0]; //0元 <span>
         add.onclick = functions(li.index, 1);
         minus.onclick = functions(li.index, -1);
      }

   };
   </script>
</head>

<body>
   <p>
      商品合计共：<strong>0</strong>件，共花费了：<span>0</span>元
      <br /> 其中最贵的商品单价是：<span>0</span>元
   </p>
   <ul id="list">
      <li>
         <input type="button" value="-" />
         <strong>0</strong>
         <input type="button" value="+" /> 单价：
         <em>12.5元</em> 小计：
         <span>0元</span>
      </li>
      <li>
         <input type="button" value="-" />
         <strong>0</strong>
         <input type="button" value="+" /> 单价：
         <em>10.5元</em> 小计：
         <span>0元</span>
      </li>
      <li>
         <input type="button" value="-" />
         <strong>0</strong>
         <input type="button" value="+" /> 单价：
         <em>8.5元</em> 小计：
         <span>0元</span>
      </li>
      <li>
         <input type="button" value="-" />
         <strong>0</strong>
         <input type="button" value="+" /> 单价：
         <em>8元</em> 小计：
         <span>0元</span>
      </li>
      <li>
         <input type="button" value="-" />
         <strong>1</strong>
         <input type="button" value="+" /> 单价：
         <em>100元</em> 小计：
         <span>100元</span>
      </li>
      <li>
         <input type="button" value="-" />
         <strong>0</strong>
         <input type="button" value="+" /> 单价：
         <em>14.5元</em> 小计：
         <span>0元</span>
      </li>
   </ul>
</body>

</html>
