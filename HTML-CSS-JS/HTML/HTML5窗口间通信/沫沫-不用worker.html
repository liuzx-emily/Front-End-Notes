<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>不用worker-沫沫</title>
    <style>
    canvas {
        border: 1px solid black;
    }
    </style>
    <script>
    var oCanvas;
    var ctx;
    window.onload = function() {
        init();
    };

    function init() {
        oCanvas = document.querySelector('canvas');
        ctx = oCanvas.getContext('2d');
        ctx.fillStyle = 'crimson';
        ctx.font = "bold 100px '黑体'";
        var aLi = document.querySelectorAll('li');
        for (let i = 0; i < aLi.length; i++) {
            aLi[i].onclick = show;
        }
    }


    function show() {
        console.time(1);
        var text = this.innerText;
        //每次点击后，先清空之前的所有画：
        ctx.clearRect(0, 0, oCanvas.width, oCanvas.height);
        //写字，只是为了获得ImageData
        ctx.textBaseline = 'top';
        ctx.fillText(text, 0, 0);
        //获得文字，存在myText中
        var w = ctx.measureText(text).width; //文字的宽
        var h = 100; //文字的高，也就是字体的大小100px
        var myText = ctx.getImageData(0, 0, w, h);
        //获得文字后，可以清空画布了
        ctx.clearRect(0, 0, oCanvas.width, oCanvas.height);
        //利用myText给newText赋值：
        var arr = randNum(w * h, w * h / 5);
        var newText = ctx.createImageData(myText);
        for (let i = 0; i < arr.length; i++) {
            let startIndex = 4 * arr[i];
            newText.data[startIndex] = myText.data[startIndex];
            newText.data[startIndex + 1] = myText.data[startIndex + 1];
            newText.data[startIndex + 2] = myText.data[startIndex + 2];
            newText.data[startIndex + 3] = myText.data[startIndex + 3];
        }
        ctx.putImageData(newText, 0, 0);
        console.timeEnd(1);

    }

    function randNum(iAll, iWant) {
        var arr = [];
        var newArr = [];
        for (let i = 0; i < iAll; i++) {
            arr.push(i);
        }
        for (let i = 0; i < iWant; i++) {
            let random = Math.floor(Math.random() * arr.length);
            newArr.push(arr.splice(random, 1));
        }
        return newArr;
    }
    </script>
</head>

<body>
    <canvas width="500" height="400"></canvas>
    <ol>
        <li>小当家</li>
        <li>数码宝贝</li>
        <li>钢炼</li>
        <li>银之匙</li>
    </ol>
</body>

</html>
