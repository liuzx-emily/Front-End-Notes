<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>马赛克</title>
    <style>
    canvas {
        border: 1px solid black;
    }
    </style>
    <script>
    var oCanvas;
    var ctx;
    var oImg;

    window.onload = function() {
        init();
        var oImg = new Image();
        oImg.onload = function() {
            var w = 400;
            var h = 250;
            ctx.drawImage(oImg, 0, 0, w, h);
            var myImg = ctx.getImageData(0, 0, w, h);
            var iP = 5;
            for (let i = 0; i < Math.ceil(w / iP); i++) {
                for (let j = 0; j < Math.ceil(h / iP); j++) {
                    let x = i * iP + Math.floor(Math.random() * iP);
                    let y = j * iP + Math.floor(Math.random() * iP);
                    var color = getXY(myImg, x, y);
                    for (let m = 0; m < iP; m++) {
                        for (let n = 0; n < iP; n++) {
                            setXY(myImg, i * iP + m, j * iP + n, color);
                        }
                    }
                }
            }
            ctx.putImageData(myImg, 0, h);

        };
        oImg.src = '1.jpg';
    };

    function init() {
        oCanvas = document.querySelector('canvas');
        ctx = oCanvas.getContext('2d');
    }

    function getXY(obj, x, y) {
        var w = obj.width;
        var h = obj.height;
        var sIndex = 4 * (x + y * w);
        var color = [];
        for (var i = 0; i < 4; i++) {
            color.push(obj.data[sIndex + i]);
        }
        return color;
    }

    function setXY(obj, x, y, color) {
        var w = obj.width;
        var h = obj.height;
        var sIndex = 4 * (x + y * w);
        for (var i = 0; i < 4; i++) {
            obj.data[sIndex + i] = color[i];
        }
    }
    </script>
</head>

<body>
    <canvas width="500" height="800"></canvas>
</body>

</html>
