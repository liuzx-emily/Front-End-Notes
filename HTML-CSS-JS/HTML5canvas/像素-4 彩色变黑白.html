<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>将彩色图片变黑白</title>
    <style>
    canvas {
        border: 1px solid black;
    }
    </style>
    <script>
    var oCanvas;
    var ctx;
    var oImg;

    window.onload = function() {
        init();
        var oImg = new Image();
        oImg.onload = function() {
            var w = 400;
            var h = 250;
            ctx.drawImage(oImg, 0, 0, w, h);
            var myImg = ctx.getImageData(0, 0, w, h);
            for (let i = 0; i < myImg.width; i++) {
                for (let j = 0; j < myImg.height; j++) {
                    let aColor = getXY(myImg, i, j);
                    let newC = (aColor[0] + aColor[1] + aColor[2]) / 3;
                    setXY(myImg, i, j, [newC, newC, newC, 255]);
                }
            }
            ctx.putImageData(myImg, 0, h);

        };
        oImg.src = '1.jpg';
    };

    function init() {
        oCanvas = document.querySelector('canvas');
        ctx = oCanvas.getContext('2d');
    }

    function getXY(obj, x, y) {
        var w = obj.width;
        var h = obj.height;
        var sIndex = 4 * (x + y * w);
        var color = [];
        for (var i = 0; i < 4; i++) {
            color.push(obj.data[sIndex + i]);
        }
        return color;
    }

    function setXY(obj, x, y, color) {
        var w = obj.width;
        var h = obj.height;
        var sIndex = 4 * (x + y * w);
        for (var i = 0; i < 4; i++) {
            obj.data[sIndex + i] = color[i];
        }
    }
    </script>
</head>

<body>
    <canvas width="500" height="800"></canvas>
</body>

</html>
